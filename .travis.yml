sudo: false

addons:
  apt:
    packages:
      - google-chrome-stable
      - ocl-icd-opencl-dev

language: java

jdk:
  - openjdk8
  - openjdk11
  - openjdk12

env:
  global:
    - CHROMEDRIVER_BINARY=~/chromedriver

cache:
  directories:
    - $HOME/.m2
    - $HOME/cache/install-jdk

before_install:
  - wget -N http://chromedriver.storage.googleapis.com/2.34/chromedriver_linux64.zip -P ~/
  - unzip ~/chromedriver_linux64.zip -d ~/
  - rm ~/chromedriver_linux64.zip
  - sudo chmod +x ~/chromedriver
  - whereis google-chrome-stable
  - whereis chromedriver
  - wget -N https://github.com/sormuras/bach/raw/master/install-jdk.sh -P ~/
  - sudo chmod +x ~/install-jdk.sh
  - sudo chmod +x .travis/deploy.sh
  - openssl aes-256-cbc -K $encrypted_41bc8c83cf90_key -iv $encrypted_41bc8c83cf90_iv -in .travis/gpg.all.enc -out ./all.gpg -d
  - gpg --import ./all.gpg

install: true

script:
  - mvn clean install -P jvmtestsonly

deploy:
  - provider: script
    script: .travis/deploy.sh
    skip_cleanup: true
    on:
      repo: mirkosertic/Bytecoder
      branch: '#171'
      jdk: openjdk8
  - provider: script
    script: .travis/deploy.sh
    skip_cleanup: true
    on:
      repo: mirkosertic/Bytecoder
      tags: true
      jdk: openjdk8